<link rel="stylesheet" href="/css/search.css">

<div class="search-page">
    <!-- ê²€ìƒ‰ì°½ -->
    <div class="search-container">
        <form id="searchForm" class="search-form">
            <div class="search-input-group">
                <input type="text" 
                       class="search-input" 
                       id="stockInput" 
                       placeholder="ì¢…ëª©ëª… ë˜ëŠ” ì¢…ëª©ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                       value="<%= stock || '' %>" 
                       required />
                <button type="submit" class="search-btn">ê²€ìƒ‰</button>
            </div>
        </form>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ -->
    <div class="search-results">
        <% if (stock && results.length > 0) { %>
            <div class="results-header">
                <span class="results-count">ì´ <%= totalResults %>ê°œ ì¢…ëª© (í˜ì´ì§€ <%= currentPage %>/<%= totalPages %>)</span>
            </div>
            <div class="stock-list">
                <% results.forEach(function(item) { %>
                    <div class="stock-item" onclick="selectStock('<%= item.code %>', '<%= item.name %>')">
                        <div class="stock-main">
                            <div class="stock-name"><%= item.name %></div>
                            <div class="stock-code"><%= item.code %></div>
                        </div>
                        <div class="stock-market">
                            <div class="market-type"><%= item.market %></div>
                        </div>
                    </div>
                <% }); %>
            </div>
            
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <% if (totalPages > 1) { %>
                <div class="pagination">
                    <!-- ì´ì „ í˜ì´ì§€ -->
                    <% if (currentPage > 1) { %>
                        <a href="/search?stock=<%= encodeURIComponent(stock) %>&page=<%= currentPage - 1 %>" class="page-btn prev-btn">â€¹ ì´ì „</a>
                    <% } %>
                    
                    <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ -->
                    <div class="page-numbers">
                        <% 
                            // ëª¨ë°”ì¼ì—ì„œëŠ” ë” ì ì€ í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ
                            let pageRange = 1; // í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ ì¢Œìš° 1ê°œì”©ë§Œ í‘œì‹œ
                            let startPage = Math.max(1, currentPage - pageRange);
                            let endPage = Math.min(totalPages, currentPage + pageRange);
                            
                            if (startPage > 1) { %>
                                <a href="/search?stock=<%= encodeURIComponent(stock) %>&page=1" class="page-btn">1</a>
                                <% if (startPage > 2) { %>
                                    <span class="page-dots">...</span>
                                <% } %>
                            <% }
                            
                            for (let i = startPage; i <= endPage; i++) { %>
                                <a href="/search?stock=<%= encodeURIComponent(stock) %>&page=<%= i %>" 
                                   class="page-btn <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
                            <% }
                            
                            if (endPage < totalPages) { %>
                                <% if (endPage < totalPages - 1) { %>
                                    <span class="page-dots">...</span>
                                <% } %>
                                <a href="/search?stock=<%= encodeURIComponent(stock) %>&page=<%= totalPages %>" class="page-btn"><%= totalPages %></a>
                            <% } %>
                    </div>
                    
                    <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                    <% if (currentPage < totalPages) { %>
                        <a href="/search?stock=<%= encodeURIComponent(stock) %>&page=<%= currentPage + 1 %>" class="page-btn next-btn">ë‹¤ìŒ â€º</a>
                    <% } %>
                </div>
            <% } %>
        <% } else if (stock && results.length === 0) { %>
            <div class="no-results">
                <div class="no-results-icon">ğŸ”</div>
                <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p class="suggestion">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</p>
            </div>
        <% } else { %>
            <div class="search-guide">
                <div class="guide-icon">ğŸ’¡</div>
                <h3>ì¢…ëª© ê²€ìƒ‰ ê°€ì´ë“œ</h3>
                <ul>
                    <li>íšŒì‚¬ëª…ì˜ ì¼ë¶€ë§Œ ì…ë ¥í•´ë„ ê²€ìƒ‰ë©ë‹ˆë‹¤ (ì˜ˆ: "LG", "ì‚¼ì„±")</li>
                    <li>ì¢…ëª©ì½”ë“œë¡œë„ ê²€ìƒ‰ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ì˜ˆ: "066570")</li>
                    <li>ê²€ìƒ‰ ê²°ê³¼ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                </ul>
            </div>
        <% } %>
    </div>
</div>

<script>
    // ê²€ìƒ‰ ì´ë²¤íŠ¸
    document.getElementById('searchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const stock = document.getElementById('stockInput').value.trim();
        if(stock) {
            window.location.href = `/search?stock=${encodeURIComponent(stock)}`;
        }
    });

    // ì¢…ëª© ì„ íƒ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
    function selectStock(code, name) {
        // ì¢…ëª© ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
        const marketElement = event.currentTarget.querySelector('.market-type');
        const market = marketElement ? marketElement.textContent : '';
        window.location.href = `/stock-details?market=${encodeURIComponent(market)}&code=${encodeURIComponent(code)}&name=${encodeURIComponent(name)}`;
    }
</script>
