<link rel="stylesheet" href="/css/my-stocks.css">

<div class="my-stocks-container">
    <div class="page-header">
        <h1>내 종목</h1>
        <p class="page-description">관심있는 종목들을 한눈에 확인하세요</p>
    </div>
    
    <div class="stocks-content">
        <% if (myStocks && myStocks.length > 0) { %>
            <div class="stocks-grid">
                <% myStocks.forEach(stock => { %>
                    <div class="stock-card" data-stock-code="<%= stock.stock_code %>">
                        <div class="stock-header">
                            <div class="stock-info">
                                <h3 class="stock-name"><%- stock.stock_name %></h3>
                                <div class="stock-meta">
                                    <span class="stock-code"><%= stock.stock_code %></span>
                                    <span class="market-badge <%= stock.stock_market.toLowerCase() %>">
                                        <%= stock.stock_market %>
                                    </span>
                                </div>
                            </div>
                            <button class="remove-btn" onclick="removeStock('<%= stock.stock_code %>', this.getAttribute('data-stock-name'))" 
                                    data-stock-name="<%- stock.stock_name %>" title="내 종목에서 제거">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="stock-actions">
                            <a href="/stock-details?market=<%= stock.stock_market %>&code=<%= stock.stock_code %>&name=<%= encodeURIComponent(stock.stock_name) %>" 
                               class="view-details-btn">
                                <i class="fas fa-chart-line"></i>
                                상세 보기
                            </a>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-star"></i>
                </div>
                <h2>아직 내 종목이 없습니다</h2>
                <p>관심있는 종목을 검색해서 내 종목에 추가해보세요!</p>
                <a href="/search" class="add-stock-btn">
                    <i class="fas fa-search"></i>
                    종목 검색하기
                </a>
            </div>
        <% } %>
    </div>
</div>

<script>
// 내 종목에서 제거 함수
async function removeStock(stockCode, stockName) {
    if (!confirm(`"${stockName}"을(를) 내 종목에서 제거하시겠습니까?`)) {
        return;
    }
    
    try {
        const response = await fetch('/my-stocks', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                stock_code: stockCode
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // 성공 시 해당 카드 제거 애니메이션
            const stockCard = document.querySelector(`[data-stock-code="${stockCode}"]`);
            stockCard.style.opacity = '0';
            stockCard.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                window.location.reload();
            }, 300);
        } else {
            alert(data.message || '제거 중 오류가 발생했습니다.');
        }
    } catch (error) {
        console.error('Error removing stock:', error);
        alert('서버 통신 오류가 발생했습니다.');
    }
}
</script>
